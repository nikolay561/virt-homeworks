# Домашнее задание к занятию 6. «Troubleshooting»## Задача 1Перед выполнением задания ознакомьтесь с документацией по [администрированию MongoDB](https://docs.mongodb.com/manual/administration/).Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD-операция в MongoDB и её нужно прервать. Вы как инженер поддержки решили произвести эту операцию:- напишите список операций, которые вы будете производить для остановки запроса пользователя;- предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB.## Ответ:Найти проблемный запрос через команду - `db.currentOp()`\Прервать процесс через команду -  `db.killOp()`\Можно использовать параметр maxTimeMS() для запросов CRUD в MongoDB, использовать индексы.## Задача 2Перед выполнением задания познакомьтесь с документацией по [Redis latency troobleshooting](https://redis.io/topics/latency).Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. Причём отношение количества записанных key-value-значений к количеству истёкших значений есть величина постоянная иувеличивается пропорционально количеству реплик сервиса. При масштабировании сервиса до N реплик вы увидели, что:- сначала происходит рост отношения записанных значений к истекшим,- Redis блокирует операции записи.Как вы думаете, в чём может быть проблема? ## Ответ:Проблема появляется в связи с хранением большого количества устаревших ключей, при использовании больших объемов ОЗУ.В Redis присутствует механиз отчистки истекающих ключей, когда их значение доходит до 25% от кол-ва всех ключей.В связи с этим Redis может блокировать операции записи, когда заканчивается место в памяти, а процесс отчистки не запускается автоматически.## Задача 3Вы подняли базу данных MySQL для использования в гис-системе. При росте количества записей в таблицах базыпользователи начали жаловаться на ошибки вида:```pythonInterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '```Как вы думаете, почему это начало происходить и как локализовать проблему?Какие пути решения этой проблемы вы можете предложить?## Ответ:Обычно подобная ошибка свидетельстивует о возможных проблемах с подключением к сети.Также подобное может происходить когда клиент пытается установить первоначальное соединение с сервером, можно увеличить значение connect_timeout десяти секунд.Причиной еще может быть проблема со значениями BLOB, которые больше, чем max_allowed_packet. Переодически можно видеть сообщение ER_NET_PACKET_TOO_LARGE, что подтверждает необходимость увеличяить max_allowed_packet.## Задача 4Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с большим объёмом данных лучше, чем MySQL.После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:`postmaster invoked oom-killer`Как вы думаете, что происходит?Как бы вы решили эту проблему?## Ответ:Из-за нехватки памяти oom-killer убивает процесс postmaster, являющимся основным в postgreSQL, он поднимает остальные процессы и перезапускает их или весь сервер, при необходимости.Из этой статьи https://habr.com/ru/companies/southbridge/articles/464245/ следует, что можно изменить переменную vm.overcommit_memory, также можно увеличить значение /proc/sys/vm/swappiness.Также можно, согласно этой статье https://interface31.ru/tech_it/2022/09/linux---nachinayushhim-chto-takoe-oom-killer-i-kak-on-rabotaet.html , в конфигурацию сервиса можно добавитьв секцию [Service] значение OOMScoreAdjust, что позволит уменьшить кол-во очков процесса на указанное в OOMScoreAdjust, в свою очредь это защитит службу от oom-killer.---### Как cдавать заданиеВыполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.---